pwd = ''
bid = ''

aliveInterval = 10 ;econet

if 0 == 1 then
inputbox 'pwd' 'please pwd'
pwd = inputstr
inputbox 'bid' 'please bid'
bid = inputstr
sendln 'SKSETPWD C ' pwd
sendln 'SKSETRBID' bid
endif

connect '/C=5'
setbaud 115200

fileopen fh 'dokoda.txt' 1


while 1 == 1
    timeout = aliveInterval
    waitregex '^r\r'
    if result == 0 then
        call Alive
    else
        call InstantPower
    endif
endwhile

end


:Join

/*
strdim scanRes 5
scanRes[0] = '  Channnel:'
scanRes[1] = '  Channnel Page:'
scanRes[2] = '  Pan ID:'
scanRes[3] = '  Addr:'
scanRes[4] = '  PairID:'

while a?
    sendln 'SKSCAN 3 FFFFFFFF 6'

    for i 0 4
        waitln scanRes[i]
        if result == 0 then
            strconcat scanRes[i] 'No Res'
            messagebox scanRes[i] 'ERROR'
            end
        endif
        strtrim inputstr scanRes[i]
        scanRes[i] = inputstr
    next
endwhile

sendln 'SKLL64 ' scanRes[3]
waitln ':'
if result == 1 scanRes[3] = inputstr

sendln 'SKSREG S2 ' scanRes[0]
sendln 'SKSREG S3 ' scanRes[2]
sendln 'SKJOIN ' scanRes[3]

E25 = 1
while E25 == 1
    waitln 'EVENT24' 'EVENT25'
    if result == 1 continue
    if result == 2 E25 = 0
endwhile
*/

return



:Alive
;call join
;if
; sendln 'SKREJOIN'
;isAlive OK
;SKPING 0 
;recv / 30 min
return

:Recive
waitln 'ERXUDP' 'EVENT' 'EVENT29'
if result == 0 call a
if result == 1 call b
if result == 2 call c
return

:ERXUDP
strtrim
return

:InstantPower
frame = '1081000005FF010288016201E700'
lenFrame = strlen frame
lenFlame = lenFrame / 2

sendln 'SKSENDTO 1 ' scanRes[3] ' 0E1A 1 0 ' lenFrame
send $10$81$00$00$05$FF$01$02$88$01$62$01$E7$00
waitln 'E7'
waitln'asdijfoias'
sendln 'adfs'
;waitln 'E05'
messagebox inputstr 'insta'
getdate t "%Y-%m-%d %H:%M:%S"
strconcat t ' new\r\n'
fileseek fh 0 2
filewriteln fh t
return
